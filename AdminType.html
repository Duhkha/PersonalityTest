<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>User Panel</title>
    <link rel="stylesheet" href="assets/css/forms.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

</head>
<body>
    <table id="types-table" class="table table-bordered">
        <!-- Table content will be populated dynamically -->
    </table>

    <!-- Add Modal -->
  <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#addTypeModal">Add Type</button>

    <div class="modal fade" id="addTypeModal" tabindex="-1" role="dialog" aria-labelledby="addTypeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="addTypeForm">
                    <div class="modal-header">
                        <h4 class="modal-title" id="addTypeModalLabel">New Type</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="name">Name:</label>
                            <input type="text" id="name" name="name" required class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="description">Description:</label>
                            <input type="text" id="description" name="description" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="responsibilities">Responsibilities:</label>
                            <input type="text" id="responsibilities" name="responsibilities" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label for="requirements">Requirements:</label>
                            <input type="text" id="requirements" name="requirements" class="form-control" />
                        </div>
                    </div>
                    <div id="messageBox1"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        // AJAX REQUEST TO GET ALL TYPES

        getTypes();

        function getTypes() {
            $.get('rest/types', function (data) {
                var html = '';
                // Add row for "Add User" button
                html +=
                    '<tr>' +
                    '<td colspan="4"></td>' +
                    '<td><button class="btn btn-success" data-toggle="modal" data-target="#addTypeModal">Add Type</button></td>' +
                    '</tr>';

                for (var i = 0; i < data.length; i++) {
                    html +=
                        '<tr>' +
                        '<td>' + data[i].name + '</td>' +
                        '<td>' + data[i].description + '</td>' +
                        '<td>' + data[i].responsibilities + '</td>' +
                        '<td>' + data[i].requirements + '</td>' +
                        '<td><button class="btn btn-info" onclick="showEditDialog(' + data[i].id + ')">Edit Type</button></td>' +
                        '</tr>';
                }
                $("#types-table").html(html);
                console.log(data);
            });
        }

        $("#addTypeForm").validate({
            focusCleanup: true,
            errorElement: "em",
            rules: {
                name: "required",
                description: "required",
                responsibilities: "required",
                requirements: "required",
            },

            messages: {
                name: "Please enter a name",
                description: "Please enter a description",
                responsibilities: "Please enter responsibilities",
                requirements: "Please enter requirements",
            },

            highlight: function (element, errorClass) {
                $(element).fadeOut(function () {
                    $(element).fadeIn();
                });
            },

            errorPlacement: function (error, element) {
                error.appendTo("#messageBox1");
            },

            submitHandler: function (form) {
                $.post("rest/types", $("#addTypeForm").serialize())
                    .done(function () {
                        toastr.success("Type added successfully");
                        form.reset();
                        getTypes();
                    })
                    .fail(function () {
                        toastr.error("Failed to add type");
                    });
            },
        });
    </script>
</body>
</html>
